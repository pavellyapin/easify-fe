<!-- eslint-disable @angular-eslint/template/cyclomatic-complexity -->
<!-- eslint-disable @angular-eslint/template/button-has-type -->
<!-- eslint-disable @angular-eslint/template/use-track-by-function -->
<!-- eslint-disable @angular-eslint/template/prefer-control-flow -->
<div class="workouts-section">
  <h2 i18n>Started Workouts</h2>
  <div *ngIf="startedWorkouts$ | async as startedWorkouts">
    <div *ngIf="startedWorkouts.length > 0; else noStartedWorkouts">
      <div class="workouts-grid">
        <app-workout-tile
          *ngFor="let workout of startedWorkouts"
          class="workout-card"
          [workout]="workout.workout"
        />
      </div>
    </div>
    <ng-template #noStartedWorkouts>
      <p i18n>No started workouts found.</p>
    </ng-template>
  </div>
</div>

<div class="workouts-section">
  <h2 i18n>Recommended Workouts</h2>
  <div *ngIf="isLoadingRecommended">
    <p i18n>Loading recommended workouts...</p>
  </div>
  <div *ngIf="recommendedWorkouts$ | async as recommendedWorkouts">
    <div *ngIf="!isLoadingRecommended">
      <div *ngIf="recommendedWorkouts.length > 0; else noRecommendedWorkouts">
        <div class="workouts-grid">
          <app-workout-tile
            *ngFor="let workout of recommendedWorkouts"
            class="workout-card"
            [workout]="workout"
          />
        </div>
      </div>
      <ng-template #noRecommendedWorkouts>
        <p i18n>No recommended workouts found.</p>
      </ng-template>
    </div>
  </div>
</div>

<div class="workouts-section">
  <h2 i18n>All Workouts</h2>
  <!-- Tag Selection Section -->
  <div class="tag-selection">
    <mat-form-field appearance="fill" i18n-appearance>
      <mat-label i18n>Select a tag</mat-label>
      <mat-select (selectionChange)="onTagSelected($event.value)">
        <mat-option *ngFor="let tag of allTags$ | async" [value]="tag">
          {{ tag }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <div>
      <mat-chip *ngFor="let tag of selectedTags" (removed)="removeTag(tag)">
        {{ tag }}
        <mat-icon i18n matChipRemove>cancel</mat-icon>
      </mat-chip>
    </div>
  </div>
  <div *ngIf="isLoadingAll">
    <p i18n>Loading recommended workouts...</p>
  </div>
  <div *ngIf="allWorkouts$ | async as allWorkouts">
    <div *ngIf="allWorkouts.data.length > 0; else noAllWorkouts">
      <div class="workouts-grid">
        <app-workout-tile
          *ngFor="let workout of allWorkouts.data"
          class="workout-card"
          [workout]="workout"
        />
      </div>
    </div>
    <ng-template #noAllWorkouts>
      <p i18n>No workouts found.</p>
    </ng-template>
  </div>
</div>
